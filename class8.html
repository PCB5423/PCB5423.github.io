<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="BSC 6926 B53" />


<title>Workshop 8: Food webs: stable isotope mixing models</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BSC 6926</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="sylb.html">Syllabus</a>
</li>
<li>
  <a href="comp.html">Computer setup</a>
</li>
<li>
  <a href="class1.html">WS 1</a>
</li>
<li>
  <a href="class2.html">WS 2</a>
</li>
<li>
  <a href="class3.html">WS 3</a>
</li>
<li>
  <a href="class4.html">WS 4</a>
</li>
<li>
  <a href="class5.html">WS 5</a>
</li>
<li>
  <a href="class6.html">WS 6</a>
</li>
<li>
  <a href="class7.html">WS 7</a>
</li>
<li>
  <a href="class8.html">WS 8</a>
</li>
<li>
  <a href="class9.html">WS 9</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="hw1.html">HW 1</a>
</li>
<li>
  <a href="hw2.html">HW 2</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Workshop 8: Food webs: stable isotope
mixing models</h1>
<h4 class="author">BSC 6926 B53</h4>
<h4 class="date">11/8/2022</h4>

</div>


<p>This workshop covers using stable isotope mixing models to estimate
resource use in food webs.<br />
</p>
<p><a href="workshop8.R">R script of workshop 8</a></p>
<div id="stable-isotope-data" class="section level2">
<h2>Stable isotope data</h2>
<p>Energy flow is a key ecosystem function in all ecosystems, and can be
understood through understanding food web interactions. Stable isotopes
of C, N, and S are a common method to investigate food webs. Stable
isotope data is reported in delta (<span
class="math inline">\(\delta\)</span>) notation and calculated with the
following formula: <span class="math display">\[
\delta X = ((R_{sample}/R_{standard}) - 1) * 1000
\]</span> where <span class="math inline">\(\delta X\)</span> is the
stable isotope ratio of element <span class="math inline">\(X\)</span>
of the sample relative to a standard value, <span
class="math inline">\(R_{sample}\)</span> is the ratio of rare isotope
to common isotope (e.g. <sup>13</sup>C/<sup>12</sup>C) of the sample of
element <span class="math inline">\(X\)</span>, and <span
class="math inline">\(R_{standard}\)</span> is the ratio of a standard
of element <span class="math inline">\(X\)</span>. Standards are
specific to each element and are Pee Dee Belmenite for carbon, air for
nitrogen, and Vienna Canyon Diablo Troilite for sulfur. The units are
reported in per mil (‰).<br />
</p>
<div id="isotope-biplots" class="section level3">
<h3>Isotope biplots</h3>
<p>Stable isotope values are typically visualized using a biplot with
<span class="math inline">\(\delta\)</span><sup>13</sup>C values on the
x-axis and <span class="math inline">\(\delta\)</span><sup>15</sup>N or
<span class="math inline">\(\delta\)</span><sup>34</sup>S values on the
y-axis. Typical plots have source values plotted with mean <span
class="math inline">\(\pm\)</span> SD and consumers plotted as
individual values of the sample.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate metrics for each pool</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ ggplot2 3.4.0      ✔ purrr   0.3.5 </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ tibble  3.1.8      ✔ dplyr   1.0.10</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ readr   2.1.3      ✔ forcats 0.5.2 </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>bf <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/bf.csv&#39;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 8 Columns: 12</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="do">## chr (6): ID, Species, Site, season, tissue, Bay</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (6): d13C, C%, d15N, N%, d34S, S%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/sFLbayMan.csv&#39;</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 4 Columns: 11</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="do">## chr  (1): Source</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (10): Meand13C, SDd13C, Concd13C, Meand15N, SDd15N, Concd15N, Meand34S, ...</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># carbon and nitrogen</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(Meand13C, Meand15N))<span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Meand15N <span class="sc">-</span> SDd15N, <span class="at">ymax =</span> Meand15N <span class="sc">+</span> SDd15N), <span class="at">width =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Meand13C <span class="sc">-</span> SDd13C, <span class="at">xmax =</span>  Meand13C <span class="sc">+</span> SDd13C), <span class="at">height =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Source),<span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">1</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bf, <span class="fu">aes</span>(<span class="at">x =</span> d13C, <span class="at">y =</span> d15N,<span class="at">color =</span> ID), <span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(delta<span class="sc">^</span>{<span class="dv">13</span>}, <span class="st">&quot;C (\u2030)&quot;</span>)),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(delta<span class="sc">^</span>{<span class="dv">15</span>}, <span class="st">&quot;N (\u2030)&quot;</span>)))<span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="class8_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># carbon and sulfur</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s, <span class="fu">aes</span>(Meand13C, Meand34S))<span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">pch=</span><span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Meand34S <span class="sc">-</span> SDd34S, <span class="at">ymax =</span> Meand34S <span class="sc">+</span> SDd34S), <span class="at">width =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Meand13C <span class="sc">-</span> SDd13C, <span class="at">xmax =</span>  Meand13C <span class="sc">+</span> SDd13C), <span class="at">height =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Source),<span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">1</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bf, <span class="fu">aes</span>(<span class="at">x =</span> d13C, <span class="at">y =</span> d34S,<span class="at">color =</span> ID), <span class="at">size=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(delta<span class="sc">^</span>{<span class="dv">13</span>}, <span class="st">&quot;C (\u2030)&quot;</span>)),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(delta<span class="sc">^</span>{<span class="dv">34</span>}, <span class="st">&quot;S (\u2030)&quot;</span>)))<span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="class8_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
</div>
</div>
<div id="mixing-models" class="section level2">
<h2>Mixing models</h2>
<p>The saying you are what you eat is true, and consumers become a
mixture of the of the atoms they consume. Therefore, if the sources are
known a consumer can become ‘unmixed’ into its sources. This is because
stable isotopes are predictable in how they change through the food web
(i.e. trophic fractionation). It is important to note that this can only
be done when all sources are accounted for and the sources differ in
isotope values.<br />
</p>
<p>Stable isotope mixing models use a system of equations to mass
balance the mixture of source isotope values to make the consumer’s
isotope value. The simplest form of a stable isotope mixing model is
with 2 sources (also commonly referred to as endmembers) and 1 isotope.
In a 2 source, 1 isotope mixing model system: <span
class="math display">\[
\delta X_{c} = f_1*\delta X_1 + f_2*\delta X_2
\]</span> where <span class="math inline">\(\delta X_{c}\)</span> is the
stable isotope value of element <span class="math inline">\(X\)</span>
for the consumer, <span class="math inline">\(f_1\)</span> is
contribution of source 1 to the consumer (i.e. resource use of source
1), <span class="math inline">\(f_2\)</span> is the contribution of
source 2, <span class="math inline">\(\delta X_1\)</span> is the isotope
value element <span class="math inline">\(X\)</span> of source 1, and
<span class="math inline">\(\delta X_2\)</span> is the isotope value
element <span class="math inline">\(X\)</span> of source 2.<br />
</p>
<p>Since the consumer can only use these 2 sources we also know that</p>
<p><span class="math display">\[
f_1 + f_2 = 1
\]</span> We can rearrange and substitute to solve for <span
class="math inline">\(f_1\)</span> with this equation: <span
class="math display">\[
\delta X_{c} = f_1*\delta X_1 + (1 - f_1)*\delta X_2
\]</span> which can be rearranged to be <span class="math display">\[
f_1 = (\delta X_{c}-\delta X_{2})/(\delta X_{1}-\delta X_{2})
\]</span> Since we know the isotope values of the consumer (<span
class="math inline">\(\delta X_{c}\)</span>) and sources (<span
class="math inline">\(\delta X_1\)</span> and <span
class="math inline">\(\delta X_2\)</span>) we can then solve for <span
class="math inline">\(f_1\)</span> and <span
class="math inline">\(f_2\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># source isotope values </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>d13C_s1 <span class="ot">=</span> <span class="sc">-</span><span class="dv">27</span> <span class="co"># mangrove</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>d13C_s2 <span class="ot">=</span> <span class="sc">-</span><span class="dv">12</span> <span class="co"># seagrass</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># generate random consumer values between endmembers calculate </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">d13C_c =</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="at">min =</span> d13C_s1, <span class="at">max =</span> d13C_s2), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">d13C_s1 =</span> d13C_s1, <span class="at">d13C_s2 =</span> d13C_s2) </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate each contribution</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> (d13C_c<span class="sc">-</span>d13C_s2)<span class="sc">/</span>(d13C_s1<span class="sc">-</span>d13C_s2),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">f2 =</span> <span class="dv">1</span> <span class="sc">-</span> f1)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 20 × 5</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="do">##    d13C_c d13C_s1 d13C_s2     f1     f2</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  -17.5     -27     -12 0.368  0.632 </span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  -20.9     -27     -12 0.595  0.405 </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  -18.0     -27     -12 0.402  0.598 </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  -25.4     -27     -12 0.893  0.107 </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  -21.3     -27     -12 0.618  0.382 </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  -19.8     -27     -12 0.520  0.480 </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  -15.9     -27     -12 0.257  0.743 </span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  -24.3     -27     -12 0.820  0.180 </span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  -19.2     -27     -12 0.480  0.520 </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  -13.2     -27     -12 0.0784 0.922 </span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 11  -12.5     -27     -12 0.0343 0.966 </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 12  -18.6     -27     -12 0.437  0.563 </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 13  -15.3     -27     -12 0.220  0.780 </span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 14  -19.5     -27     -12 0.503  0.497 </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 15  -18.3     -27     -12 0.420  0.580 </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="do">## 16  -20.1     -27     -12 0.538  0.462 </span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 17  -24.7     -27     -12 0.848  0.152 </span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 18  -21.3     -27     -12 0.620  0.380 </span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 19  -25.9     -27     -12 0.924  0.0758</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 20  -24.4     -27     -12 0.828  0.172</span></span></code></pre></div>
<div id="bayesian-mixing-models" class="section level3">
<h3>Bayesian mixing models</h3>
<p>Since food webs are not as simple as the example above, researchers
have developed more complex models to account for variation in source
values, trophic fractionation, concentration of each element in a
source, and underdetermined systems (when # of sources &gt; # of
isotopes + 1). These models use a Bayesian framework, and
<code>MixSIAR</code> is the most common. MixSIAR uses an R interface to
run Bayesian hierarchical models by Markov Chain Monte Carlo with JAGs.
You will need to download <a
href="https://sourceforge.net/projects/mcmc-jags/">JAGs</a> for
<code>MixSIAR</code> to run. In addition, <code>MixSIAR</code> has a
great <a href="https://github.com/brianstock/MixSIAR">manual</a> with
many examples of how to use the package.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MixSIAR)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print =</span> <span class="dv">6000000</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load consumer data</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/bf.csv&#39;</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 8 Columns: 12</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## chr (6): ID, Species, Site, season, tissue, Bay</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (6): d13C, C%, d15N, N%, d34S, S%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 8 × 12</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   ID       Species Site   d13C  `C%`  d15N  `N%`  d34S  `S%` season tissue Bay  </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 BB1RTm   Bonefi… Tott… -11.7  47.8 10.3  14.9   5.01 0.927 wet    muscle Bisc…</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 F-8RTm   Bonefi… Shel… -10.8  46.8  9.5  13.7  -0.57 0.825 dry    muscle Flor…</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 F-2RTm   Bonefi… Ratt… -15.0  51.4  9.76 13.1   6.29 0.849 dry    muscle Flor…</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 R-1 9MR… Bonefi… Nine… -11.7  51.1 10.4  14.8   2.83 0.44  dry    muscle Flor…</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 R-2KBRTm Bonefi… Key … -15.8  50.3  8.84 15.4   6.29 0.928 dry    muscle Bisc…</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 F-13RTm  Bonefi… Crab… -10.0  31.1  9.17  9.31  1.67 0.736 dry    muscle Flor…</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 F-16RTm  Bonefi… Crab… -10.4  45.3  9.17 13.6   0.77 0.822 dry    muscle Flor…</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 F-1RTm   Bonefi… Airp… -12.5  49.5  9.4  11.0   5.71 0.356 dry    muscle Flor…</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>mix <span class="ot">=</span> <span class="fu">load_mix_data</span>(<span class="at">file =</span> <span class="st">&quot;data/bf.csv&quot;</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iso_names=</span><span class="fu">c</span>(<span class="st">&quot;d13C&quot;</span>,<span class="st">&quot;d34S&quot;</span>, <span class="st">&#39;d15N&#39;</span>),</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">factors=</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fac_random=</span><span class="fu">c</span>(F),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fac_nested=</span><span class="fu">c</span>(F),</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cont_effects=</span><span class="cn">NULL</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># load source data</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/sFLbayMan.csv&#39;</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 4 Columns: 11</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="do">## chr  (1): Source</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (10): Meand13C, SDd13C, Concd13C, Meand15N, SDd15N, Concd15N, Meand34S, ...</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 11</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="do">##   Source    Meand…¹ SDd13C Concd…² Meand…³ SDd15N Concd…⁴ Meand…⁵ SDd34S Concd…⁶</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Algae       -18.6   3.84    30.0   2.55   2.53     2.35   19.6    3.25   2.73 </span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Epiphytes   -13.6   2.15    48     0.435  0.484    8      10.1    2.55   2    </span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Seagrass    -11.3   1.60    37.8  -0.527  3.09     2.14    3.96   3.95   0.498</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Mangrove    -27.7   1.1     44     1.1    1.45     1.5   -13.5    3.8    0.5  </span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 1 more variable: n &lt;dbl&gt;, and abbreviated variable names ¹​Meand13C,</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="do">## #   ²​Concd13C, ³​Meand15N, ⁴​Concd15N, ⁵​Meand34S, ⁶​Concd34S</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>source <span class="ot">=</span> <span class="fu">load_source_data</span>(<span class="at">file =</span> <span class="st">&quot;data/sFLbayMAN.csv&quot;</span>,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                          <span class="at">source_factors=</span><span class="cn">NULL</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                          <span class="at">conc_dep=</span><span class="cn">TRUE</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data_type=</span><span class="st">&quot;means&quot;</span>,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                          mix)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># load TEF data</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/FLbayTEF3.csv&quot;</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 4 Columns: 7</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="do">## chr (1): Source</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (6): Meand15N, SDd15N, Meand13C, SDd13C, Meand34S, SDd34S</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 7</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="do">##   Source    Meand15N SDd15N Meand13C SDd13C Meand34S SDd34S</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Seagrass       8.7      1        3    0.3      1.2    0.2</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Algae          8.7      1        3    0.3      1.2    0.2</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Epiphytes      8.7      1        3    0.3      1.2    0.2</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Mangrove       8.7      1        3    0.3      1.2    0.2</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">=</span> <span class="fu">load_discr_data</span>(<span class="at">file =</span> <span class="st">&quot;data/FLbayTEF3.csv&quot;</span>, mix)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Make an isospace plot</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(<span class="at">filename=</span><span class="st">&quot;isospace_plot&quot;</span>, <span class="at">plot_save_pdf=</span><span class="cn">FALSE</span>, <span class="at">plot_save_png=</span><span class="cn">FALSE</span>, mix,source,discr)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MixSIAR)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print =</span> <span class="dv">6000000</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the JAGS model file</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_filename <span class="ot">=</span> <span class="st">&quot;MixSIAR_model.txt&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>resid_err <span class="ot">=</span> F <span class="co">#variation in consumer assimilation (Stock and Semmens 2016 for in depth explanation https://esajournals-onlinelibrary-wiley-com.ezproxy.fiu.edu/doi/10.1002/ecy.1517)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>process_err <span class="ot">=</span> T <span class="co">#variation in sampling of source values</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_JAGS_model</span>(model_filename, resid_err, process_err, mix, source)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># run model </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># | run ==  | Chain Length | Burn-in | Thin | # Chains |</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   | ------------- | ------------- | ------------- | ------------- | ------------- |</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;test&quot; | 1,000 | 500 | 1 | 3 |</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;very short&quot; | 10,000 | 5,000 | 5 | 3 |</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;short&quot; | 50,000 | 25,000 | 25 | 3 |</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;normal&quot; | 100,000 | 50,000 | 50 | 3 |</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;long&quot; | 300,000 | 200,000 | 100 | 3 |</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;very long&quot; | 1,000,000 | 500,000 | 500 | 3 |</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   | &quot;extreme&quot; | 3,000,000 | 1,500,000 | 500 | 3 |</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># run jags</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>jags.bf <span class="ot">=</span> <span class="fu">run_model</span>(<span class="at">run=</span><span class="st">&quot;long&quot;</span>, mix, source, discr, model_filename,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha.prior =</span> <span class="dv">1</span>, resid_err, process_err)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Process JAGS output</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>output_bf <span class="ot">=</span> <span class="fu">list</span>(<span class="at">summary_save =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">summary_name =</span> <span class="st">&quot;MixingModels/mm_results/bf_ss&quot;</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sup_post =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_post_save_pdf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_post_name =</span> <span class="st">&quot;lower_posterior_density&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sup_pairs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_pairs_save_pdf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_pairs_name =</span> <span class="st">&quot;lower_pairs_plot&quot;</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sup_xy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_xy_save_pdf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_xy_name =</span> <span class="st">&quot;lower_xy_plot&quot;</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gelman =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">heidel =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geweke =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">diag_save =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">diag_name =</span> <span class="st">&quot;mm_results/bf_diag&quot;</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">indiv_effect =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_post_save_png =</span> F,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_pairs_save_png =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plot_xy_save_png =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="fu">output_JAGS</span>(jags.bf, mix, source, output_bf)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="fu">summary_stat</span>(jags.bf)</span></code></pre></div>
</div>
<div id="load-mixing-model-data" class="section level3">
<h3>Load mixing model data</h3>
<p>This is a custom function that was written to import the output of
the mixing models</p>
<p><strong>note</strong> for this to work, all columns must be on the
same row like this:<br />
<img src="mmOutputEx.PNG" /></p>
<p>and not wrapped like this:<br />
<img src="mmOutputBad.PNG" /></p>
<p>Use the <code>mixTable</code> function to load data</p>
<p><code>file =</code> name of name of .txt of summary stats from
<code>MixSIAR</code></p>
<p><code>type =</code> ‘identifier’ for use of the data set</p>
<p><code>ind = F</code> if <code>TRUE</code> will output with columns as
source values, default is <code>FALSE</code> and will output data with
columns as mean, sd, and posterior distribution quantiles: lowend =
2.5%, highend = 97.5%, mid = 50%, low = 25%, up = 75%, ymax = 75%
quantile + 1.5 * IQR, ymin = 25% quantile - 1.5 * IQR</p>
<p><code>nest = F</code> if nested mixing model, <code>TRUE</code> will
return the sources of nested</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mixTable <span class="ot">=</span> <span class="cf">function</span>(file,type,<span class="at">ind =</span> F,<span class="at">nest =</span> F){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  cn <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;ID&#39;</span>, <span class="st">&#39;Mean&#39;</span>, <span class="st">&#39;SD&#39;</span>, <span class="st">&#39;2.5%&#39;</span>, <span class="st">&#39;5%&#39;</span>, <span class="st">&#39;25%&#39;</span>, <span class="st">&#39;50%&#39;</span>, <span class="st">&#39;75%&#39;</span>, <span class="st">&#39;95%&#39;</span>, <span class="st">&#39;97.5%&#39;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">read_fwf</span>(file, <span class="at">skip =</span> <span class="dv">8</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(x) <span class="ot">=</span> cn</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>source <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>name <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>code <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nest <span class="sc">==</span> F){</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x)){</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">=</span> <span class="fu">strsplit</span>(x<span class="sc">$</span>ID, <span class="at">split =</span> <span class="st">&#39;.&#39;</span>, <span class="at">fixed =</span> T)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>source[i] <span class="ot">=</span> temp[[i]][<span class="dv">3</span>]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>name[i] <span class="ot">=</span> temp[[i]][<span class="dv">2</span>]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>type <span class="ot">=</span> type</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>ymax <span class="ot">=</span> x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>(x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">-</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>ymin <span class="ot">=</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span> <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span>(x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">-</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> <span class="fu">data.frame</span>(x<span class="sc">$</span>name, x<span class="sc">$</span>type, x<span class="sc">$</span>source, x<span class="sc">$</span>Mean, x<span class="sc">$</span>SD, x<span class="sc">$</span><span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                      x<span class="sc">$</span><span class="st">`</span><span class="at">50%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span>, x<span class="sc">$</span>ymax, x<span class="sc">$</span>ymin)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;type&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>, <span class="st">&#39;lowend&#39;</span>, <span class="st">&#39;highend&#39;</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;mid&#39;</span>, <span class="st">&#39;low&#39;</span>, <span class="st">&#39;up&#39;</span>, <span class="st">&#39;ymax&#39;</span>, <span class="st">&#39;ymin&#39;</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x)){</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">=</span> <span class="fu">strsplit</span>(x<span class="sc">$</span>ID, <span class="at">split =</span> <span class="st">&#39;.&#39;</span>, <span class="at">fixed =</span> T)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>source[i] <span class="ot">=</span> temp[[i]][<span class="dv">4</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>code[i] <span class="ot">=</span> temp[[i]][<span class="dv">3</span>]</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>name[i] <span class="ot">=</span> temp[[i]][<span class="dv">2</span>]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>type <span class="ot">=</span> type</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>ymax <span class="ot">=</span> x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>(x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">-</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>ymin <span class="ot">=</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span> <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span>(x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span> <span class="sc">-</span> x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> <span class="fu">tibble</span>(x<span class="sc">$</span>name, x<span class="sc">$</span>type, x<span class="sc">$</span>source, x<span class="sc">$</span>code, x<span class="sc">$</span>Mean, x<span class="sc">$</span>SD, x<span class="sc">$</span><span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                  x<span class="sc">$</span><span class="st">`</span><span class="at">50%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">25%</span><span class="st">`</span>, x<span class="sc">$</span><span class="st">`</span><span class="at">75%</span><span class="st">`</span>, x<span class="sc">$</span>ymax, x<span class="sc">$</span>ymin)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;type&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;code&#39;</span>, <span class="st">&#39;mean&#39;</span>, <span class="st">&#39;sd&#39;</span>, <span class="st">&#39;lowend&#39;</span>, <span class="st">&#39;highend&#39;</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;mid&#39;</span>, <span class="st">&#39;low&#39;</span>, <span class="st">&#39;up&#39;</span>, <span class="st">&#39;ymax&#39;</span>, <span class="st">&#39;ymin&#39;</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)){</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (df<span class="sc">$</span>ymax[i] <span class="sc">&gt;</span> df<span class="sc">$</span>highend[i]){</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>ymax[i] <span class="ot">=</span> df<span class="sc">$</span>highend[i]</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (df<span class="sc">$</span>ymin[i] <span class="sc">&lt;</span> df<span class="sc">$</span>lowend[i]){</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>ymin[i] <span class="ot">=</span> df<span class="sc">$</span>lowend[i]</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> df <span class="sc">%&gt;%</span> drop_na <span class="sc">%&gt;%</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&#39;global&#39;</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ind <span class="sc">==</span> T){</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nest <span class="sc">==</span> T){</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(name, type, code, source, mean) <span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;source&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;mean&#39;</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(name, type, source, mean)<span class="sc">%&gt;%</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;source&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;mean&#39;</span>)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bf <span class="ot">=</span> <span class="fu">mixTable</span>(<span class="st">&#39;data/bf_ss.txt&#39;</span>, <span class="st">&#39;Bonefish&#39;</span>, <span class="at">ind =</span> T, <span class="at">nest =</span> F)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bf</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 8 × 6</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   name      type     Algae Epiphytes Mangrove Seagrass</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 BB1RTm    Bonefish 0.016     0.137    0.184    0.664</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 F-13RTm   Bonefish 0.01      0.075    0.095    0.82 </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 F-16RTm   Bonefish 0.009     0.071    0.108    0.812</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 F-1RTm    Bonefish 0.02      0.203    0.188    0.589</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 F-2RTm    Bonefish 0.028     0.238    0.32     0.414</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 F-8RTm    Bonefish 0.009     0.06     0.124    0.807</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 R-1 9MRTm Bonefish 0.013     0.104    0.158    0.725</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 R-2KBRTm  Bonefish 0.029     0.241    0.365    0.364</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> bf <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Algae<span class="sc">:</span>Seagrass, <span class="at">names_to =</span> <span class="st">&#39;source&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;value&#39;</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(b, <span class="fu">aes</span>(source,value, <span class="at">fill =</span> source))<span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> source), <span class="at">position =</span> <span class="st">&#39;jitter&#39;</span>)<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&#39;Source Contribution&#39;</span>)<span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<p><img src="class8_files/figure-html/load%20show-1.png" width="672" /></p>
</div>
<div id="calculate-trophic-level" class="section level3">
<h3>Calculate trophic level</h3>
<p>You can calculate the trophic level (<span
class="math inline">\(TL\)</span>) of a consumer with the folowing
formula: <span class="math display">\[
TL = \frac{\delta^{15}N_c - \sum f_i*\delta^{15}N_i}{\Delta^{15}N} + 1
\]</span> where <span class="math inline">\(\delta^{15}N_c\)</span> is
the consumer <span class="math inline">\(\delta^{15}N\)</span> of the
consumer and <span class="math inline">\(\sum
f_i*\delta^{15}N_i\)</span> is the isotope value of the consumer at
trophic level 1 based on the mixing model outputs for contribution of
source <span class="math inline">\(i\)</span> (<span
class="math inline">\(f_i\)</span>) multiplied by the <span
class="math inline">\(\delta^{15}N\)</span> of that source, and <span
class="math inline">\(\Delta^{15}N\)</span> is the trophic enrichment
factor for <span class="math inline">\(\delta^{15}N\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine mixing model output with isotope source files</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>bf1 <span class="ot">=</span> bf <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">ID =</span> name, Algae, Epiphytes, Mangrove, Seagrass)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/bf.csv&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bf1, <span class="at">by =</span> <span class="st">&#39;ID&#39;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 8 Columns: 12</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## chr (6): ID, Species, Site, season, tissue, Bay</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (6): d13C, C%, d15N, N%, d34S, S%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&#39;data/sFLbayMan.csv&#39;</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 4 Columns: 11</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Delimiter: &quot;,&quot;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="do">## chr  (1): Source</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">## dbl (10): Meand13C, SDd13C, Concd13C, Meand15N, SDd15N, Concd15N, Meand34S, ...</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>tef <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nTL1 =</span> Algae<span class="sc">*</span>s<span class="sc">$</span>Meand15N[s<span class="sc">$</span>Source <span class="sc">==</span> <span class="st">&#39;Algae&#39;</span>]<span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                Epiphytes<span class="sc">*</span>s<span class="sc">$</span>Meand15N[s<span class="sc">$</span>Source <span class="sc">==</span> <span class="st">&#39;Epiphytes&#39;</span>]<span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                Mangrove<span class="sc">*</span>s<span class="sc">$</span>Meand15N[s<span class="sc">$</span>Source <span class="sc">==</span> <span class="st">&#39;Mangrove&#39;</span>]<span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                Seagrass<span class="sc">*</span>s<span class="sc">$</span>Meand15N[s<span class="sc">$</span>Source <span class="sc">==</span> <span class="st">&#39;Seagrass&#39;</span>],</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">TL =</span> (d15N <span class="sc">-</span> nTL1)<span class="sc">/</span>tef <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>TL</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.449125 4.246715 4.150460 4.520051 3.817218 4.146608 4.141866 4.121502</span></span></code></pre></div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
